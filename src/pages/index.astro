---
import '../styles/global.css';
import App from '../App';
const logoUrl = `/cover_cafe_logo.svg`;
const siteUrl = 'https://covers.cafe';
const pageTitle = 'covers.cafe - Album Cover Art Gallery';
const pageDescription = 'Discover, upload, and download high-quality album cover art. Browse thousands of covers from your favorite artists and albums.';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <link rel="canonical" href={siteUrl} />
    <link rel="icon" type="image/svg+xml" href={logoUrl} />

    <!-- Open Graph -->
    <meta property="og:site_name" content="covers.cafe" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />

    <!-- Twitter / X Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />

    <!-- Prevent flash of wrong theme -->
    <script is:inline>
      (function () {
        var t = localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        var noThemeImages = localStorage.getItem('pref_no_theme_images') === '1';
        var gridMinWidth = parseInt(localStorage.getItem('pref_cover_grid_min_width') || '160', 10);
        if (!isFinite(gridMinWidth)) gridMinWidth = 160;
        document.documentElement.setAttribute('data-theme', t);
        document.documentElement.setAttribute('data-no-theme-images', noThemeImages ? 'true' : 'false');
        document.documentElement.style.setProperty('--cover-grid-min-width', gridMinWidth + 'px');

        // Restore gradient colours and compute accessible text colours.
        if (t === 'gradient') {
          var gStart = localStorage.getItem('pref_gradient_start') || '#4f46e5';
          var gEnd   = localStorage.getItem('pref_gradient_end')   || '#db2777';
          document.documentElement.style.setProperty('--gradient-start', gStart);
          document.documentElement.style.setProperty('--gradient-end',   gEnd);

          // WCAG 2.1 relative luminance â€” inline so it runs before React hydrates.
          function toLinear(c) { var s = c / 255; return s <= 0.03928 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4); }
          function hexToLum(hex) {
            var h = hex.replace('#','');
            if (h.length !== 6) return 0.5;
            var r = parseInt(h.slice(0,2),16), g = parseInt(h.slice(2,4),16), b = parseInt(h.slice(4,6),16);
            return 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);
          }
          var lumS = hexToLum(gStart), lumE = hexToLum(gEnd);
          var midLum = (lumS + lumE) / 2;
          var useDark = (1.05 / (midLum + 0.05)) < ((midLum + 0.05) / 0.05);
          var textColor = useDark ? '#000000' : '#ffffff';
          var isBright = useDark;
          document.documentElement.style.setProperty('--gradient-text',       textColor);
          document.documentElement.style.setProperty('--gradient-text-muted', isBright ? 'rgba(0,0,0,0.55)' : 'rgba(255,255,255,0.65)');
          document.documentElement.style.setProperty('--gradient-border',     isBright ? 'rgba(0,0,0,0.18)' : 'rgba(255,255,255,0.18)');
          document.documentElement.style.setProperty('--gradient-card-bg',    isBright ? 'rgba(255,255,255,0.18)' : 'rgba(0,0,0,0.18)');
          document.documentElement.style.setProperty('--gradient-panel-bg',   isBright ? 'rgba(255,255,255,0.22)' : 'rgba(0,0,0,0.22)');
        }
      })();
    </script>
    <!-- Prefetch skeuomorphic theme images immediately so they are ready when rendered -->
    <script is:inline>
      (function () {
        if (localStorage.getItem('pref_no_theme_images') === '1') return;
        var imgs = [
          '/themes/themedark/hero-banner_dark-mode.jpg',
          '/themes/themedark/album-card-info_dark-mode.jpg',
          '/themes/themedark/btn btn-primary_dark-mode.jpg',
          '/themes/themelight/hero-banner_light-mode.jpg',
          '/themes/themelight/album-card-info_light-mode.jpg',
          '/themes/themelight/btn btn-primary_light-mode.jpg'
        ];
        for (var i = 0; i < imgs.length; i++) {
          var el = new Image();
          el.src = imgs[i];
        }
      })();
    </script>
  </head>
  <body>
    <App client:only="react" />
  </body>
</html>
